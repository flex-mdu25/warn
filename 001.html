<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://image.makewebeasy.net/makeweb/0/pMrtkmxgt/APNG_images/bot_02.png?v=202012190947" rel="shortcut icon">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous" />
    <title>Share Flex Message</title>
  </head>
  <body>
    <center>
      <p> . . . . . กำลังโหลด . . . . .</p>
      <img src="https://image.makewebeasy.net/makeweb/0/pMrtkmxgt/APNG_images/loader1_1.gif?v=202012190947" alt="loading" width="126" height="129" />
      <p>กรุณารอสักครู่<br>wait...</p>
    </center>

    <script>
      window.onload = function() {
        liff.init({
          liffId: "2006945143-l6J406dZ"
        }).then(() => {
          if (liff.isLoggedIn()) {
            dolink();
          } else {
            liff.login();
          }
        }).catch(err => {
          console.error('LIFF Initialization failed', err);
        });

        function getParameterByName(name, url) {
          if (!url) url = window.location.href;
          name = name.replace(/[\[\]]/g, '\\$&');
          var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
              results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return '';
          return decodeURIComponent(results[2].replace(/\+/g, ' '));
        };

function getThaiDate() {
          const days = ["วันอาทิตย์", "วันจันทร์", "วันอังคาร", "วันพุธ", "วันพฤหัสบดี", "วันศุกร์", "วันเสาร์"];
          const months = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];

          const now = new Date();
          const dayName = days[now.getDay()];
          const day = now.getDate();
          const month = months[now.getMonth()];
          const year = now.getFullYear() + 543; // แปลงเป็น พ.ศ.

          return `${dayName} ที่ ${day} ${month} พ.ศ.${year}`;
        }

        
        function dolink() {
          var j5 = getParameterByName("refer");

          if (j5 === "001") {
            liff.shareTargetPicker([{
              "type": "flex",
              "altText": "แจ้งเตือนลงเวลาปฏิบัติงาน",
              "contents": {
                "type": "bubble",
                "size": "giga",
                "body": {
                  "type": "box",
                  "layout": "vertical",
                  "contents": [
                    {
                      "type": "image",
                      "url": "https://raw.githubusercontent.com/flex-mdu25/warn/refs/heads/main/alert.png",
                      "size": "full",
                      "aspectMode": "cover",
                      "aspectRatio": "2:1"
                    },
                    {
                      "type": "box",
                      "layout": "vertical",
                      "contents": [{
                        "type": "text",
                        "text": getThaiDate(),
                        "weight": "bold",
                        "align": "center",
                        "color": "#ffffff"
                      }],
                      "position": "absolute",
                      "width": "100%",
                      "offsetTop": "sm"
                    },
                    {
                      "type": "box",
                      "layout": "vertical",
                      "contents": [{
                        "type": "image",
                        "url": "https://raw.githubusercontent.com/flex-mdu25/warn/refs/heads/main/share.png"
                      }],
                      "position": "absolute",
                      "width": "100%",
                      "height": "40%",
                      "offsetStart": "55px",
                      "offsetEnd": "0px",
                      "offsetBottom": "0px",
                      "action": {
                        "type": "uri",
                        "label": "action",
                        "uri": "https://liff.line.me/2006945143-l6J406dZ?refer=001"
                      }
                    }
                  ],
                  "paddingAll": "0px"
                }
              }
            }])
            .then(() => {
              Swal.fire({
                position: 'top-center',
                icon: 'success',
                title: 'ส่ง เรียบ ร้อย',
                showConfirmButton: false,
                timer: 1500
              }).then(() => {
                liff.closeWindow();
              });
            })
            .catch(err => {
              console.error('Share failed', err);
            });
          }
        }
      };
    </script>

    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
  </body>
</html>
